# ESP8266 Router Power Control

基于 ESP8266 的路由器电源控制系统，支持多通道电流监测、定时控制和过流保护。

## 功能特点

- 3通道独立控制
- 实时电流、电压、功率监测
- 定时开关控制
- 过流保护
- Web界面控制
- OTA固件升级

## 硬件要求

- ESP8266开发板
- INA3221电流传感器
- 3路继电器模块
- 5V电源

## 接线说明

- INA3221:
  - SDA -> D2
  - SCL -> D1
  - VCC -> 3.3V
  - GND -> GND

- 继电器:
  - IN1 -> D5
  - IN2 -> D6
  - IN3 -> D7
  - VCC -> 5V
  - GND -> GND

## 软件功能

### 主界面
![主界面](imgs/index.png)

主界面显示三个通道的实时状态，包括：
- 继电器开关状态
- 电流值
- 电压值
- 功率值

### 定时控制
![定时控制](imgs/timers.png)

支持以下定时功能：
- 单次定时
- 每日重复
- 工作日重复
- 周末重复
- 自定义星期重复

### 过流保护
![过流保护](imgs/currentprotects.png)

每个通道可独立设置电流保护阈值：
- 当电流超过设定值时自动关闭对应通道
- 手动重新开启后重置保护状态
- 实时显示保护状态

### 功率曲线
![功率曲线](imgs/curves.png)

支持查看历史数据曲线：
- 功率曲线
- 电流曲线
- 电压曲线

### 系统配置
![系统配置](imgs/config.png)

支持以下配置：
- WiFi连接设置
- MQTT服务器配置
- 系统参数设置

### 固件升级
![固件升级](imgs/webupgrade.png)

支持通过Web界面上传新固件：
- 支持.bin格式固件
- 显示升级进度
- 自动重启应用新固件

## 编译说明

1. 安装Arduino IDE
2. 安装ESP8266开发板支持
3. 安装必要的库：
   - ArduinoJson
   - INA3221_RT
   - ESP8266WiFi
   - ESP8266WebServer
   - ESP8266mDNS
   - ESP8266HTTPUpdate
4. 编译并上传固件

## 使用说明

1. 首次使用时会创建AP热点，SSID为"ESP8266_AP"
2. 连接AP后访问192.168.4.1进行WiFi配置
3. 配置完成后设备会自动连接到指定WiFi
4. 通过Web界面进行各项功能设置

## 注意事项

- 确保电源供应稳定
- 定期检查电流保护阈值设置
- 建议使用5V/2A以上电源适配器
- 注意继电器的最大负载电流

## 许可证

MIT License

## 作者

[Your Name]

## 更新日志

### v1.0.0
- 初始版本发布
- 支持基本的电源监控功能
- 支持 Web 界面控制
- 支持 MQTT 数据上报
- 支持 AP 模式配置
